# import Factory kivy.factory.Factory

<Message>:
    background_color: 0,0,0,0  # the last zero is the critical on, make invisible
    canvas.before:
        Color:
            rgba: (189/255,194/255,199/255,1)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [20,]
        Rectangle:
            pos: self.pos if self.message_from=='bobby' else (self.pos[0]+self.width/2,self.pos[1])
            size: self.size[0]/2, self.size[1]/2

        Color:
            rgba: (1,1,1,1) if self.message_from=='bobby' else (239/255,254/255,221/255,1)
        RoundedRectangle:
            pos: (self.pos[0], self.pos[1]+2) if self.message_from=='bobby' else (self.pos[0]+2, self.pos[1]+2)
            size: self.size[0]-2, self.size[1]-2
            radius: [18,]
        Rectangle:
            pos: (self.pos[0], self.pos[1]+2) if self.message_from=='bobby' else (self.pos[0]+self.width/2+2,self.pos[1]+2)
            size: self.size[0]/2-2, self.size[1]/2-2
    padding: (12, 10)
    size_hint_y: None
#    orientation: 'vertical'

    content_label: content_label
    time_label: time_label

#    Label:
#        id: time_label
#        text: '21:59'
#        font_size: 10
#        font_name: 'Roboto'
#        background_color: 0,0,0,0
#        color: 180/255, 180/255, 180/255, 1

    Label:
        id: content_label
        text: 'Message'
        font_size: 14
        font_name: 'Roboto'
        background_color: 0,0,0,0
        color: 'black'
        size_hint_y: None
        text_size: self.width, None
        size: self.texture_size

    Label:
        id: time_label
        size_hint_x: None
        size_hint_y: None

        size: self.texture_size
        text: '21:59'
        font_size: 10
        font_name: 'Roboto'
        background_color: 0,0,0,0
        color: 180/255, 180/255, 180/255, 1

#<PopupButton>:
#    auto_dismiss: True
#    title: ''
#    size_hint: 0.3, 0.2
#    pos_hint: {'center_x': 0.5, 'bottom': 0.06}
#    background_color: 0,0,0,0
#    foreground_color: 0,0,0,0
#    Button:
#        size_hint: 1, 1
#        text: 'v'

<Container>:
    orientation: 'vertical'

    upper_panel: upper_panel
    messages_panel: messages_panel
    input_panel: input_panel
    text_input: text_input
    enter_btn: enter_btn

    BoxLayout:  # верхняя панель
        id: upper_panel
        canvas:
            Color:
                rgba: (81/255, 125/255, 162/255, 1)
            Rectangle:
                pos: self.pos
                size: self.size
        size_hint: (1, 0.1)

        ClickableLabel:
            container: root
            color: 'white'
            text: 'Bobby'
            font_size: 16

    RecycleView:  # панель сообщений
        id: messages_panel
        canvas.before:
            Color:
                rgba: (211/255, 233/255, 235/255, 1)
            Rectangle:
                pos: self.pos
                size: self.size
        size_hint: (1, 0.84)
        bar_color: 81/255, 125/255, 162/255, 1
        viewclass: 'BoxLayout'

        messages: messages_layout

        BoxLayout:
            id: messages_layout
            orientation: 'vertical'
            size_hint_y: None
            size_hint_x: 1
            size: 1, self.spacing
            padding: 5
            spacing: 5

    BoxLayout:  # панель ввода
        id: input_panel
        canvas:
            Color:
                rgba: (1, 1, 1, 1)
            Rectangle:
                pos: self.pos
                size: self.size
        size_hint: (1, 0.06)

        ScrollView:
            TextInput:
                id: text_input
                background_color: 0,0,0,0
                hint_text: 'Enter text here'
                cursor_color: 81/255, 125/255, 162/255, 1
                cursor_width: 2
                padding: (10, 8)
                text_size: self.size
                font_size: 14
                font_name: 'Roboto'
                multiline: True

        Button:
            id: enter_btn
            foreground_color: 1,1,1,1
            background_color: 0,0,0,0
            text: '<' if root.text_input.text != '' else 'v'
            font_size: 18 if root.text_input.text != '' else 16
            color: 81/255, 125/255, 162/255, 1
            size_hint: (.1, 1)
            on_press:
                self.background_color = 211/255, 233/255, 235/255, 0.3
                root.get_data_from_user()
            on_release:
                self.background_color = 0,0,0,0
                root.text_input.focus = True
